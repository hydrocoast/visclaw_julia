# control PostScript files generated by GMT.jl
###################################################
"""
Rename /tmp/GMTtmp.ps to another name
"""
function moveps(outps::String)
    if !occursin("/",outps)
        outeps="./"*outps
    end
    tmpps = GMT.fname_out(Dict())[1]
    run(`mv $tmpps $outps`)
    return nothing
end
###################################################

###################################################
"""
Convert /tmp/GMTtmp.ps to eps file
"""
function saveaseps(outeps::String)
    if !occursin("/",outeps)
        outeps="./"*outeps
    end
    tmpps = GMT.fname_out(Dict())[1]
    run(`ps2eps -f -q $tmpps`)
    tmpeps= replace(tmpps, r"\.ps$" => ".eps")
    run(`mv $tmpeps $outeps`)
    return nothing
end
###################################################

###################################################
"""
Convert /tmp/GMTtmp.ps to png file
"""
function saveaspng(outpng::String; dpi=300::Int64)
    tmpps = GMT.fname_out(Dict())[1]
    run(`ps2eps -f -q $tmpps`)
    tmpeps= replace(tmpps, r"\.ps$" => ".eps")
    run(`convert -density $dpi $tmpeps $outpng`)
    return nothing
end
###################################################

###################################################
"""
Convert ps files to eps files
"""
function ps2eps_series(nstep::Int64; savedir="."::String, savename="eta"::String)
    for i = 1:nstep
        # filename
        filename = joinpath(savedir,savename)*@sprintf("%03d",i-1)*".ps"
        if !isfile(filename); disp("Not found: $filename"); continue; end;
        run(`ps2eps -f -q $filename`)
        run(`rm $filename`)
    end
    return nothing
end
###################################################

###################################################
"""
Convert eps files to ong file
"""
function eps2png_series(nstep::Int64; reserve=true::Bool,
                 savedir="."::String, savename="eta"::String, dpi=300::Int64)
    for i = 1:nstep
        # filename
        filename = joinpath(savedir,savename)*@sprintf("%03d",i-1)*".eps"
        pngname = replace(filename, r"\.eps" => ".png")
        if !isfile(filename); disp("Not found: $filename"); continue; end;
        run(`convert -density $dpi $filename $pngname`)
        if !reserve;
            run(`rm $filename`)
        end
    end
    return nothing
end
